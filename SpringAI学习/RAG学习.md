### RAG的技术路线:

##### 1、文本、知识库上传，过滤url，邮件等等

##### 2、文本切分，切成文本块，固定大小块

##### 3、召回，根据结果查看效果

![](https://github.com/WeiGuang1214/Study-Notes/blob/master/images/rag01.png)

我们目前做的rag工程就是在文本切分和处理这部分，构建知识库。

#### 分块因素:

​	1、模型处理能力限制
​	2、被索引内容的性质,长文本或者短消息
​	3、用户查询的长度和复杂性

#### 分块方法:

​	固定大小、512
​	动态切分，句子、段落，markdown格式切分，latex格式切分
​	NLP内容切分库，NLTK/spcay
​	递归分块
​	分块之后要构建索引-向量和chunk，把chunk转换成向量库里面的向量，对文档内容进行高效查询。

![](https://github.com/WeiGuang1214/Study-Notes/blob/master/images/rag02.png)

#### 如何构建索引?

1、层次索引，适用于从大量文档中高效检索信息，即摘要信息，先通过摘要过滤出文档块，再进行内容搜索。
2、知识图片索引
前置处理:
	用户查询的改写：因为用户的查询不清楚，所以需要前置处理，分解成子查询，比如意图识别，转换成若干个子问题进行求解，这样可以分别召回相关内容，再去判断哪些是符合的。
	也可以是先根据用户的问题，搜一些内容出来，再把相关内容和问题给大模型
	也可以是把历史对话和问题一起扔给大模型，问大模型本次提问到底是什么问题，然后再检索

后置处理:
	过滤和重排，通过对关键字、元数据、热度等等过滤，或者是根据相似度得分，LLM、Cohere进行重新排序，对召回结果进行重排序和过滤。

#### RAG评估:

##### 1、检索模块:

​	主要是衡量检索系统在查询和任务排名项目的有效性，这些指标包括命中率、平均排名倒数、归一化折扣累积增益、精确度等等。

##### 2、生成模块:

​	生成模块指的是将检索到的文档与查询相结合，形成增强或合成的输入，这与最终答案或相应的生成不同，后者通常采用端到端的评估方式，生成模块主要关注上下文相关性。

##### 端到端的评估:

​	有标签内容的评估：准确度、精确匹配
​	无标签内容的评估：答案的准确性、相关性、无害性
​	分为人工评估和大模型的自动评估

##### 关键指标:

​	答案的准确度、答案的相关性、上下文的相关性

##### 	评估框架RAGAS，需要手写数据集，重点是结构化数据集，数据怎么来?

#### RAG的边界问题:

​	RAG的应用场景主要是在有大量知识的前提下，对信息的及时性、准确性、可解释性和可信度、数据安全隐私，以及成本更低等方面，本质上是为了检索相关信息，提供相关上下文的检索生成。
​	微调主要是需要让大模型进行广泛学习，模型需要模仿特定的结构、风格或者格式的时候，微调就显得非常有用，提高模型的表现，使交互跟加有效，本质上是为了提高交互能力和有效性。成本较高并且容易遗忘知识。
​	多模态，图片通过OCR提取出来，用多模态大模型进行分析处理。
