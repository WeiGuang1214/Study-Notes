- **宿主机**是运行 Docker 守护进程（`dockerd`）的机器，无论是物理机还是虚拟机。
- **容器**是宿主机上运行的轻量级进程，共享宿主机的内核，但拥有独立的文件系统和资源。
- 如果 Docker 运行在虚拟机中：
  该虚拟机是宿主机，负责管理 Docker 容器。
  宿主机的文件系统是虚拟机的文件系统，而非物理机的文件系统。
  例如：在 VirtualBox 中创建虚拟机并安装 Docker，此时虚拟机就是宿主机。

### Docker 数据卷挂载的过程

#### 1. 数据卷的概念

数据卷（Volume）是 Docker 提供的一种机制，用于在容器和宿主机之间或多个容器之间共享和持久化数据。数据卷是一个可供一个或多个容器使用的特殊目录，它绕过了容器的文件系统，直接在宿主机的文件系统中存储数据。

#### 2. 挂载过程

当你使用 Docker 运行容器时，可以通过 `-v` 或 `--mount` 选项来指定数据卷挂载：

docker run -v /host/path:/container/path image_name

- `/host/path`：这是宿主机上的目录路径。如果该目录不存在，Docker 会自动创建它。
- `/container/path`：这是容器内的目录路径。容器在启动时会将该目录挂载到宿主机的指定目录上。

启动一个 MySQL 容器并挂载数据卷：

docker run -v /my/own/datadir:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw mysql:latest

##### 使用 `--mount` 选项

docker run --mount type=bind,source=/host/path,target=/container/path image_name

### 为什么要进行数据卷挂载

#### 1. 数据持久化

容器的生命周期是短暂的，当容器被删除时，容器内的数据也会随之丢失。通过数据卷挂载，可以将数据存储在宿主机上，即使容器被删除，数据仍然可以保留。例如，在使用数据库容器时，将数据库的数据目录挂载到宿主机上，这样在容器升级或重新创建时，数据不会丢失。

#### 2. 数据共享

可以将同一个数据卷挂载到多个容器上，实现容器之间的数据共享。例如，多个应用容器可以共享一个配置文件目录，方便进行配置管理。

#### 3. 方便开发和调试

在开发过程中，可以将宿主机上的代码目录挂载到容器内，这样在宿主机上修改代码后，容器内的应用可以立即使用最新的代码，无需重新构建容器。

### 中间件通过 Docker 容器启动并设置数据库的原理

#### 1. 数据库容器的启动

当你启动一个数据库容器（如 MySQL、PostgreSQL 等）时，容器内部会运行数据库服务。数据库服务会将数据存储在特定的目录中，例如 MySQL 默认将数据存储在 `/var/lib/mysql` 目录下。

#### 2. 数据卷挂载的作用

为了确保数据库数据的持久化，需要将容器内的数据库数据目录挂载到宿主机上。这样，即使数据库容器被删除或重新创建，数据仍然可以保留在宿主机上。同时，通过挂载数据卷，你还可以在宿主机上对数据库数据进行备份、恢复等操作。

#### 3. 配置数据库

在启动数据库容器时，通常需要设置一些环境变量来配置数据库，例如数据库的根密码、数据库名等。以 MySQL 为例：

docker run -v /my/own/datadir:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -e MYSQL_DATABASE=mydb mysql:latest

- `-e MYSQL_ROOT_PASSWORD=my-secret-pw`：设置 MySQL 的根密码为 `my-secret-pw`。
- `-e MYSQL_DATABASE=mydb`：创建一个名为 `mydb` 的数据库。

容器启动时，会根据这些环境变量进行相应的配置，并将数据存储在挂载的数据卷中。

综上所述，通过数据卷挂载和环境变量配置，可以方便地在 Docker 容器中启动和管理数据库，同时保证数据的持久化和可管理性。

**数据卷是保障数据库数据持久化和一致性的关键机制**

```plaintext
应用 → 数据库连接 → 数据库服务 → 数据卷（宿主机存储）
```